<!DOCTYPE html>
<html>

<head>
  <title>frontend</title>
  <script>
    const stack = [];

    function get_stack_str(results) {
      const [pointer, len] = [stack.pop(), stack.pop()];
      const buffer = new Uint8Array(
        results.exports.memory.buffer,
        pointer,
        len
      );
      const str = String.fromCharCode(...buffer);
      results.exports.dealloc_str(pointer);
      return str;
    }

    var wasm_file = location.origin + '/target/wasm32-unknown-unknown//release/web_frontend.wasm';
    fetch(wasm_file).then(response =>
      response.arrayBuffer()
    ).then(bytes =>
      WebAssembly.instantiate(bytes, {
        env: {
          stack_push: (val) => stack.push(val),
        }
      })
    ).then(results => {
      wasm = results.instance;
      wasm.exports.solve_fb();
      const str = get_stack_str(wasm);
      console.log(str);
    });
  </script>
</head>

<body>
</body>

</html>
